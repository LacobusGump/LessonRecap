<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Lesson Notes Formatter - Instant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .app-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .input-section, .output-section {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .secondary-button {
            background: #6c757d;
        }
        
        .output-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            min-height: 200px;
            border: 1px solid #dee2e6;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            background: #d4edda;
            color: #155724;
            border: 1px solid #28a745;
        }
        
        .examples {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        .example-button {
            background: #e9ecef;
            color: #495057;
            font-size: 14px;
            padding: 8px 16px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .example-button:hover {
            background: #dee2e6;
        }
        .speed-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ Music Lesson Notes Formatter <span class="speed-badge">INSTANT</span></h1>
        
        <div class="app-card">
            <div class="status">
                âœ… Ready - Instant formatting, no AI model needed!
            </div>
            
            <div class="input-section">
                <label for="lessonNotes">Enter Raw Lesson Notes:</label>
                <textarea
                    id="lessonNotes"
                    rows="8"
                    placeholder="Example: Charleigh - Worked through Black Sabbath Paranoid which I sent home through the app. You did great with it, went over some of the 16s fills..."
                ></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="formatNotes()">
                    Format Notes (Instant!)
                </button>
                <button class="secondary-button" onclick="clearAll()">
                    Clear All
                </button>
                <button class="secondary-button" onclick="copyOutput()">
                    Copy Output
                </button>
            </div>
            
            <div class="output-section">
                <label>Formatted Lesson Recap:</label>
                <div id="output" class="output-content">Formatted notes will appear here...</div>
            </div>
            
            <div class="examples">
                <label>Quick Examples:</label>
                <button class="example-button" onclick="loadExample('charleigh')">Charleigh (Drums)</button>
                <button class="example-button" onclick="loadExample('morgan')">Morgan (Drums)</button>
                <button class="example-button" onclick="loadExample('luca')">Luca (Beginner)</button>
                <button class="example-button" onclick="loadExample('conan')">Conan (Advanced)</button>
                <button class="example-button" onclick="loadExample('amaiyah')">Amaiyah (With Gear)</button>
                <button class="example-button" onclick="loadExample('seek')">Seek & Destroy</button>
                <button class="example-button" onclick="loadExample('brody')">Brody (Songs)</button>
            </div>
        </div>
    </div>
    <script>
        // Expanded music terminology dictionary for general music lessons
        const musicTerms = {
            'hh': 'hi-hat',
            'hihat': 'hi-hat',
            'hi hat': 'hi-hat',
            '16s': '16th notes',
            '16ths': '16th notes',
            '16th': '16th notes',
            '8s': '8th notes',
            '8ths': '8th notes',
            '8th': '8th notes',
            'bpm': 'bpm',
            'BPM': 'bpm',
            'kick': 'kick drum',
            'bd': 'bass drum',
            'tom': 'tom',
            'toms': 'toms',
            'snare': 'snare',
            'sd': 'snare drum',
            'fill': 'fill',
            'fills': 'fills',
            'groove': 'groove',
            'beat': 'beat',
            'pattern': 'pattern',
            'cross stick': 'cross-stick',
            'crossstick': 'cross-stick',
            'rim shot': 'rim shot',
            'rimshot': 'rim shot',
            'bossa nova': 'bossa nova',
            'bosa nova': 'bossa nova',
            'triplet': 'triplets',
            'triplets': 'triplets',
            'sixtuplet': 'sixtuplets',
            'sixtuplets': 'sixtuplets',
            'sextuplet': 'sixtuplets',
            'sextuplets': 'sixtuplets',
            'rudiment': 'rudiment',
            'rudiments': 'rudiments',
            'paradiddle': 'paradiddle',
            'flam': 'flam',
            'drag': 'drag',
            'roll': 'roll',
            'buzz': 'buzz roll',
            'double stroke': 'double stroke',
            'single stroke': 'single stroke',
            'metronome': 'metronome',
            'chord': 'chord',
            'scale': 'scale',
            'arpeggio': 'arpeggio',
            'fingering': 'fingering',
            'posture': 'posture',
            'breathing': 'breathing',
            'vocal': 'vocal',
            'maj': 'major',
            'min': 'minor',
            'dim': 'diminished',
            'aug': 'augmented',
            'sus': 'suspended',
            'key': 'key',
            'tempo': 'tempo',
            'dynamics': 'dynamics',
            'legato': 'legato',
            'staccato': 'staccato',
            'pizzicato': 'pizzicato',
            'tremolo': 'tremolo'
        };

        // Expanded common misspellings and capitalization fixes
        const spellFixes = {
            'metalica': 'Metallica',
            'metallica': 'Metallica',
            'sabath': 'Sabbath',
            'sabbath': 'Sabbath',
            'oma': 'OMA',
            'OMA': 'OMA',
            'rhthm': 'rhythm',
            'rythm': 'rhythm',
            'rythem': 'rhythm',
            'indepence': 'independence',
            'independance': 'independence',
            'brough': 'brought',
            'startwed': 'started',
            'tp': 'to',
            'lite': 'light',
            'avail': 'available',
            'hieght': 'height',
            'stedy': 'steady',
            'consistant': 'consistent',
            'practise': 'practice',
            'practis': 'practice',
            'foccus': 'focus',
            'focuss': 'focus',
            'tempos': 'tempo',
            'spead': 'speed',
            'speeds': 'speed',
            'endurence': 'endurance',
            'endurace': 'endurance',
            'techinque': 'technique',
            'technqiue': 'technique',
            'fillls': 'fills',
            'groov': 'groove',
            'patern': 'pattern',
            'pattrn': 'pattern',
            'creap': 'Creep',
            'creep': 'Creep',
            'paraniod': 'Paranoid',
            'parnoid': 'Paranoid',
            'chainsmokers': 'The Chainsmokers',
            'coldplay': 'Coldplay',
            'imagine dragons': 'Imagine Dragons',
            'hozier': 'Hozier',
            'brody': 'Brody',
            'luca': 'Luca',
            'conan': 'Conan',
            'amaiyah': 'Amaiyah',
            'charleigh': 'Charleigh',
            'morgan': 'Morgan'
        };

        // Expanded known artists and songs
        const knownArtists = {
            'Paranoid': 'Black Sabbath',
            'Running': 'OMA',
            'Friday I\'m In Love': 'The Cure',
            'Seven Nation Army': 'The White Stripes',
            'Radioactive': 'Imagine Dragons',
            'I Will Survive': 'Gloria Gaynor',
            'Master of Puppets': 'Metallica',
            'Creep': 'Radiohead',
            'CREAM': 'OMA',
            'Seek & Destroy': 'Metallica',
            'Something Just Like This': 'The Chainsmokers & Coldplay',
            'Bones': 'Imagine Dragons',
            'Too Sweet': 'Hozier'
        };

        const examples = {
            charleigh: `Charleigh - Worked through Black sabath Paranoid which i sent home through the app. you did great with it, went over some of the 16s fills which brough us into playing 16s to a metronome! (classic) Startwed at 100bpm and worked it up to 170. great job, try to keep everything nice and balanced, while maintaining even strokes! then we started to learned Running by oma. this will help with working on your kick indepence, breaking the bond your right hand and right foot naturally have. this busy beat has a lot of kick in between you hh 8th, so keep steady with this one`,
            morgan: `Morgan - Worked through The Cure - Friday I'm In Love most of the episode. We played through first at 90% speed then cranked it out at full. great job with this, spoke about technique with hh and keeping it light so we can play through the whole song. keep your kick nice and steady with the rhthm, after a bit can start to miss. try tp stay focused and keep this beat and driving! great job Again, to keep endurance try to stay lite on your right hand.`,
            luca: `Luca - Went through triplets from 60-70bpm. doing great, try for 80 next week. played through seven nation army, just the chorus to work on. played through radioactive which sounds very good! lastly we started to learn i will survive. nice work!`,
            conan: `Conan - Worked through bosa nova, playing it to a couple different songs but looking to keep it nice and consistent. Then we broke into master of puppets by metalica and worked out some of the timing. sounding really good its a come a long way. lastly we went through some foot techniques.`,
            amaiyah: `Amaiyah - worked through creep, broke down the main patterns including the cross stick at the end. Went through learning sixtuplets and played them over the song CREAM by oma. Nice work with these. for sticking its 6 hits on the snare then 2, 2, 2 startingon the snare, tom, low tom. Sorry for going over your time, we spoke about what kind of drum kit to get which i suggest to not spend over $500 to start. A nice kit to start off with is Quest Loves Pocket kit or the breakbeats kit. You will need to get cymbals and hardware as well, which i would find used on facebook market place or ebay`,
            seek: `Started learning Seek & Destroy by Metallica. Mapped out the song structure and began working through the main groove with single strokes. Keep practicing the single-stroke groove slowly, making sure it stays steady and even. Review the mapped-out sections of the song and try playing along with the track at a reduced speed. Focus on consistency â€” clear hits and solid timing.`,
            brody: `Brody played through The Chainsmokers & Coldplay - Something Just Like This and picked out the kick pattern in the chorus that we worked on a bit and brody did great with it! Also played Bones Imagine Dragons and also too sweet by hozier.`
        };

        function fixSpelling(text) {
            let fixed = text;
            
            // Fix common misspellings and capitalizations
            for (const [wrong, right] of Object.entries(spellFixes)) {
                const regex = new RegExp('\\b' + wrong + '\\b', 'gi');
                fixed = fixed.replace(regex, right);
            }
            
            // Expand music terms
            for (const [abbrev, full] of Object.entries(musicTerms)) {
                const regex = new RegExp('\\b' + abbrev + '\\b', 'gi');
                fixed = fixed.replace(regex, full);
            }
            
            return fixed;
        }

        function capitalizeProperly(text) {
            // Capitalize first letter of sentence
            text = text.charAt(0).toUpperCase() + text.slice(1);
            
            // Capitalize known artists, songs, and proper nouns
            Object.entries(knownArtists).forEach(([song, artist]) => {
                let regex = new RegExp('\\b' + song.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                text = text.replace(regex, song);
                regex = new RegExp('\\b' + artist.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                text = text.replace(regex, artist);
            });
            
            // Capitalize student names and common words
            for (const right of Object.values(spellFixes)) {
                if (right[0] === right[0].toUpperCase()) {  // If starts with capital
                    const regex = new RegExp('\\b' + right.toLowerCase() + '\\b', 'gi');
                    text = text.replace(regex, right);
                }
            }
            
            return text;
        }

        function extractSongs(text) {
            const songs = [];
            
            // Patterns for song extraction
            const patterns = [
                /played? (?:through |on |with )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|focusing|most|and)/gi,
                /worked? (?:through |on |with )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|most|focusing|and)/gi,
                /started? (?:to learn |learning )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|and)/gi,
                /learned? ["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|and)/gi,
                /ran ["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|and)/gi
            ];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    let song = match[1].trim().replace(/^(the |a |an )/i, '');
                    let artist = match[2] ? match[2].trim() : '';
                    
                    // Handle "Artist - Song" format
                    if (!artist && song.includes('-')) {
                        const parts = song.split('-').map(p => p.trim());
                        song = parts.pop();
                        artist = parts.join(' & ');
                    }
                    
                    // Handle "Song Artist" without "by" using known artists
                    if (!artist) {
                        const words = song.split(' ').map(w => w.trim());
                        if (words.length > 1) {
                            for (let i = words.length - 1; i > 0; i--) {
                                const possibleArtist = words.slice(i).join(' ');
                                if (Object.values(knownArtists).includes(possibleArtist)) {
                                    song = words.slice(0, i).join(' ');
                                    artist = possibleArtist;
                                    break;
                                }
                            }
                        }
                    }
                    
                    // Fallback to known artists if song matches a key
                    if (!artist && knownArtists[song]) {
                        artist = knownArtists[song];
                    }
                    
                    if (song && !song.match(/^(it|this|that|them|through|on|with)$/i)) {
                        songs.push({ song: capitalizeProperly(song), artist: capitalizeProperly(artist) });
                    }
                }
            });
            
            // Deduplicate
            const unique = new Map();
            songs.forEach(s => unique.set(s.song.toLowerCase(), s));
            return Array.from(unique.values());
        }

        function extractTechniques(text) {
            const techniques = new Set();
            const techPatterns = [
                /(\d+)\s*(?:-\s*)?(\d+)?\s*bpm/gi,
                /triplet[s]?/gi,
                /sixtuplet[s]?|sextuplet[s]?/gi,
                /16th[\s-]?note[s]?|16s|16th[s]?/gi,
                /8th[\s-]?note[s]?|8s|8th[s]?/gi,
                /cross[\s-]?stick/gi,
                /kick[\s-]?(?:drum|independence|pattern)?/gi,
                /hi[\s-]?hat|hh/gi,
                /foot[\s-]?(?:technique[s]?|work)/gi,
                /fill[s]?/gi,
                /groove[s]?|beat[s]?|pattern[s]?/gi,
                /bossa[\s-]?nova/gi,
                /endurance|stamina/gi,
                /single[\s-]?stroke/gi,
                /double[\s-]?stroke/gi,
                /rudiment[s]?/gi,
                /paradiddle[s]?/gi,
                /flam[s]?/gi,
                /drag[s]?/gi,
                /roll[s]?/gi,
                /buzz[\s-]?roll/gi,
                /independence/gi,
                /metronome/gi,
                /chord[s]?/gi,
                /scale[s]?/gi,
                /arpeggio[s]?/gi,
                /fingering/gi,
                /posture/gi,
                /breathing/gi,
                /vocal/gi,
                /major|minor|diminished|augmented|suspended/gi,
                /key/gi,
                /tempo/gi,
                /dynamics/gi,
                /legato/gi,
                /staccato/gi,
                /pizzicato/gi,
                /tremolo/gi
            ];
            
            techPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    techniques.add(match[0].toLowerCase());
                }
            });
            
            return Array.from(techniques);
        }

        function classifySentence(sentence) {
            const lower = sentence.toLowerCase();
            
            // Achievement indicators (past tense actions)
            const achIndicators = ['worked', 'played', 'went', 'learned', 'started', 'practiced', 'focused', 'spent', 'ran', 'broke', 'mapped', 'began', 'did', 'sounded', 'picked'];
            if (achIndicators.some(ind => lower.includes(ind))) {
                return 'achievement';
            }
            
            // Homework indicators (future/imperative)
            const hwIndicators = ['try', 'keep', 'practice', 'work on', 'focus on', 'aim for', 'next week', 'homework', 'review', 'continue', 'build', 'maintain'];
            if (hwIndicators.some(ind => lower.includes(ind))) {
                return 'homework';
            }
            
            return 'other';
        }

        function formatAchievement(sentence, songs) {
            let formatted = capitalizeProperly(sentence);
            
            // Clean up unnecessary prefixes
            formatted = formatted.replace(/^(We |Then we |Lastly we |First we |Also |And )/i, '');
            
            // Adjust pronouns to third person
            formatted = formatted.replace(/\bwe\b/gi, 'they');
            formatted = formatted.replace(/\bi\b/gi, 'the instructor');
            formatted = formatted.replace(/\byou\b/gi, 'they');
            formatted = formatted.replace(/\byour\b/gi, 'their');
            
            // Insert song quotes and artists
            songs.forEach(({ song, artist }) => {
                const songRegex = new RegExp('\\b' + song.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                const replacement = artist ? `â€œ${song}â€ (${artist})` : `â€œ${song}â€`;
                formatted = formatted.replace(songRegex, replacement);
            });
            
            // Remove duplicate praises or clean up
            formatted = formatted.replace(/great job|nice work|doing great|did great|sounds very good|sounding really good/gi, m => m + '.');
            
            // Ensure it's a complete sentence
            formatted = formatted.trim();
            if (!formatted.match(/[.!?]$/)) {
                formatted += '.';
            }
            
            return `* ${formatted}`;
        }

        function formatHomework(sentence, songs) {
            let formatted = capitalizeProperly(sentence);
            
            // Convert to imperative form
            formatted = formatted.replace(/^try (?:to |for )?/i, '');
            formatted = formatted.replace(/^keep /i, 'Keep ');
            formatted = formatted.replace(/^practice /i, 'Practice ');
            formatted = formatted.replace(/^work on /i, 'Work on ');
            formatted = formatted.replace(/^focus on /i, 'Focus on ');
            formatted = formatted.replace(/^review /i, 'Review ');
            formatted = formatted.replace(/^continue /i, 'Continue ');
            formatted = formatted.replace(/^aim for /i, 'Aim for ');
            formatted = formatted.replace(/^maintain /i, 'Maintain ');
            
            // Adjust pronouns to second person (you/your)
            formatted = formatted.replace(/\bthey\b/gi, 'you');
            formatted = formatted.replace(/\btheir\b/gi, 'your');
            
            // Insert song quotes
            songs.forEach(({ song, artist }) => {
                const songRegex = new RegExp('\\b' + song.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                const replacement = artist ? `â€œ${song}â€ (${artist})` : `â€œ${song}â€`;
                formatted = formatted.replace(songRegex, replacement);
            });
            
            // Ensure complete sentence
            formatted = formatted.trim();
            if (!formatted.match(/[.!?]$/)) {
                formatted += '.';
            }
            
            return `* ${formatted}`;
        }

        function generateInferredHomework(songs, techniques) {
            const hw = [];
            
            if (songs.length > 0) {
                songs.forEach(({ song, artist }) => {
                    const fullSong = artist ? `â€œ${song}â€ (${artist})` : `â€œ${song}â€`;
                    hw.push(`* Practice ${fullSong} slowly, focusing on accuracy and feel.`);
                });
            }
            
            if (techniques.length > 0) {
                const techList = techniques.slice(0, 3).map(t => capitalizeProperly(t)).join(', ');
                hw.push(`* Work on ${techList} with deliberate practice.`);
            }
            
            if (techniques.some(t => t.includes('bpm') || t.includes('metronome'))) {
                hw.push('* Build speed and consistency using a metronome.');
            }
            
            if (techniques.some(t => t.includes('endurance') || t.includes('stamina'))) {
                hw.push('* Build endurance by playing longer sessions without breaks.');
            }
            
            if (hw.length === 0) {
                hw.push('* Review and practice the material covered in the lesson.');
                hw.push('* Focus on technique and musical expression.');
            }
            
            return hw;
        }

        function extractExtraNote(cleanText) {
            let extraNote = '';
            
            // Equipment/gear discussion
            const kitRegex = /(?:spoke|talked|discussed|suggest|recommend).*?(?:drum kit|equipment|gear|kit|cymbals|hardware|instrument).*?(?:\.|$)/gi;
            const kitMatch = cleanText.match(kitRegex);
            if (kitMatch) {
                extraNote += kitMatch.map(m => 
                    capitalizeProperly(m.replace(/^(?:spoke|talked|discussed) (?:about|on )?/i, 'Discussed '))
                ).join(' ').trim();
                
                // Budget
                const priceMatch = cleanText.match(/\$(\d+)/);
                if (priceMatch) {
                    extraNote += ` Suggested budget under $${priceMatch[1]}.`;
                }
                
                // Specific recommendations
                const kits = ["Questlove's Pocket Kit", 'Breakbeats Kit'];
                kits.forEach(kit => {
                    if (cleanText.toLowerCase().includes(kit.toLowerCase())) {
                        extraNote += ` Recommended ${kit}.`;
                    }
                });
                
                // Sources
                if (cleanText.toLowerCase().match(/facebook|marketplace|ebay|used/)) {
                    extraNote += ' Consider used options from Facebook Marketplace or eBay.';
                }
            }
            
            // Time apology
            if (cleanText.toLowerCase().includes('sorry for going over')) {
                extraNote += ' Apologies for extending the lesson time.';
            }
            
            return extraNote.trim();
        }

        function formatNotes() {
            const input = document.getElementById('lessonNotes').value.trim();
            if (!input) {
                alert('Please enter lesson notes to format');
                return;
            }
            
            // Extract student name
            const studentMatch = input.match(/^(\w+)\s*[-:]\s*/);
            const studentName = studentMatch ? capitalizeProperly(studentMatch[1]) : '';
            
            // Clean text
            let cleanText = input.replace(/^(\w+)\s*[-:]\s*/, '').trim();
            cleanText = fixSpelling(cleanText);
            
            // Extract info
            const songs = extractSongs(cleanText);
            const techniques = extractTechniques(cleanText);
            
            // Improved sentence splitting (handle abbreviations, etc.)
            const sentences = cleanText
                .replace(/(\w\w+)\./g, '$1|')  // Temp replace abbr. like U.S.
                .split(/[\.\!\?]\s*/)
                .map(s => s.replace(/\|/g, '.').trim())
                .filter(s => s);
            
            // Classify sentences
            const achievements = [];
            const homework = [];
            const others = [];
            sentences.forEach(s => {
                const type = classifySentence(s);
                if (type === 'achievement') {
                    const formatted = formatAchievement(s, songs);
                    if (!achievements.includes(formatted)) {
                        achievements.push(formatted);
                    }
                } else if (type === 'homework') {
                    const formatted = formatHomework(s, songs);
                    if (!homework.includes(formatted)) {
                        homework.push(formatted);
                    }
                } else {
                    others.push(s);
                }
            });
            
            // Infer homework if insufficient
            if (homework.length < achievements.length / 2 + 1) {
                const inferred = generateInferredHomework(songs, techniques);
                inferred.forEach(h => {
                    if (!homework.includes(h)) {
                        homework.push(h);
                    }
                });
            }
            
            // Extra note
            const extraNote = extractExtraNote(cleanText);
            
            // Build output
            let output = `Todayâ€™s Achievements\n\n`;
            
            if (achievements.length > 0) {
                output += achievements.join('\n') + '\n\n';
            } else {
                output += `* Covered lesson material${studentName ? ` with ${studentName}` : ''}.\n`;
                if (songs.length > 0) {
                    const songList = songs.map(({ song, artist }) => artist ? `â€œ${song}â€ (${artist})` : `â€œ${song}â€`).join(', ');
                    output += `* Explored songs including ${songList}.\n`;
                }
                if (techniques.length > 0) {
                    output += `* Developed techniques such as ${techniques.map(t => capitalizeProperly(t)).join(', ')}.\n\n`;
                }
            }
            
            output += 'Homework\n\n';
            
            if (homework.length > 0) {
                output += homework.join('\n') + '\n';
            } else {
                output += '* Practice the material from todayâ€™s lesson.\n';
                output += '* Emphasize precision and musicality in your playing.\n';
            }
            
            if (extraNote) {
                output += '\nExtra Note\n\n* ' + capitalizeProperly(extraNote) + '\n';
            }
            
            document.getElementById('output').textContent = output;
        }

        function loadExample(exampleKey) {
            const textarea = document.getElementById('lessonNotes');
            textarea.value = examples[exampleKey];
        }

        function clearAll() {
            document.getElementById('lessonNotes').value = '';
            document.getElementById('output').textContent = 'Formatted notes will appear here...';
        }

        function copyOutput() {
            const outputText = document.getElementById('output').innerText;
            navigator.clipboard.writeText(outputText).then(() => {
                alert('Output copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy text');
            });
        }
    </script>
</body>
</html>
