<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Lesson Notes Formatter - Instant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .app-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .input-section, .output-section {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .secondary-button {
            background: #6c757d;
        }
        
        .output-content {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            min-height: 200px;
            border: 1px solid #dee2e6;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .status {
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            background: #d4edda;
            color: #155724;
            border: 1px solid #28a745;
        }
        
        .examples {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        .example-button {
            background: #e9ecef;
            color: #495057;
            font-size: 14px;
            padding: 8px 16px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .example-button:hover {
            background: #dee2e6;
        }
        .speed-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎵 Music Lesson Notes Formatter <span class="speed-badge">INSTANT</span></h1>
        
        <div class="app-card">
            <div class="status">
                ✅ Ready - Instant formatting, no AI model needed!
            </div>
            
            <div class="input-section">
                <label for="lessonNotes">Enter Raw Lesson Notes:</label>
                <textarea
                    id="lessonNotes"
                    rows="8"
                    placeholder="Example: Charleigh - Worked through Black Sabbath Paranoid which I sent home through the app. You did great with it, went over some of the 16s fills..."
                ></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="formatNotes()">
                    Format Notes (Instant!)
                </button>
                <button class="secondary-button" onclick="clearAll()">
                    Clear All
                </button>
                <button class="secondary-button" onclick="copyOutput()">
                    Copy Output
                </button>
            </div>
            
            <div class="output-section">
                <label>Formatted Lesson Recap:</label>
                <div id="output" class="output-content">Formatted notes will appear here...</div>
            </div>
            
            <div class="examples">
                <label>Quick Examples:</label>
                <button class="example-button" onclick="loadExample('charleigh')">Charleigh (Drums)</button>
                <button class="example-button" onclick="loadExample('morgan')">Morgan (Drums)</button>
                <button class="example-button" onclick="loadExample('luca')">Luca (Beginner)</button>
                <button class="example-button" onclick="loadExample('conan')">Conan (Advanced)</button>
                <button class="example-button" onclick="loadExample('amaiyah')">Amaiyah (With Gear)</button>
                <button class="example-button" onclick="loadExample('seek')">Seek & Destroy</button>
            </div>
        </div>
    </div>
    <script>
        // Expanded music terminology dictionary
        const musicTerms = {
            'hh': 'hi-hat',
            'hihat': 'hi-hat',
            'hi hat': 'hi-hat',
            '16s': '16th notes',
            '16ths': '16th notes',
            '16th': '16th notes',
            '8s': '8th notes',
            '8ths': '8th notes',
            '8th': '8th notes',
            'bpm': 'bpm',
            'BPM': 'bpm',
            'kick': 'kick drum',
            'bd': 'bass drum',
            'tom': 'tom',
            'toms': 'toms',
            'snare': 'snare',
            'sd': 'snare drum',
            'fill': 'fill',
            'fills': 'fills',
            'groove': 'groove',
            'beat': 'beat',
            'pattern': 'pattern',
            'cross stick': 'cross-stick',
            'crossstick': 'cross-stick',
            'rim shot': 'rim shot',
            'rimshot': 'rim shot',
            'bossa nova': 'bossa nova',
            'bosa nova': 'bossa nova',
            'triplet': 'triplets',
            'triplets': 'triplets',
            'sixtuplet': 'sixtuplets',
            'sixtuplets': 'sixtuplets',
            'sextuplet': 'sixtuplets',
            'sextuplets': 'sixtuplets',
            'rudiment': 'rudiment',
            'rudiments': 'rudiments',
            'paradiddle': 'paradiddle',
            'flam': 'flam',
            'drag': 'drag',
            'roll': 'roll',
            'buzz': 'buzz roll',
            'double stroke': 'double stroke',
            'single stroke': 'single stroke',
            'metronome': 'metronome',
            'chorus': 'chorus',
            'verse': 'verse',
            'bridge': 'bridge',
            'intro': 'intro',
            'outro': 'outro',
            'independence': 'independence'
        };

        // Expanded common misspellings and fixes
        const spellFixes = {
            'metalica': 'Metallica',
            'metallica': 'Metallica',
            'sabath': 'Sabbath',
            'sabbath': 'Sabbath',
            'oma': 'OMA',
            'OMA': 'OMA',
            'rhthm': 'rhythm',
            'rythm': 'rhythm',
            'rythem': 'rhythm',
            'indepence': 'independence',
            'independance': 'independence',
            'brough': 'brought',
            'startwed': 'started',
            'tp': 'to',
            'lite': 'light',
            'avail': 'available',
            'either': 'hi-hat',  // Assuming common typo for 'hi-hat'
            'hieght': 'height',
            'stedy': 'steady',
            'consistant': 'consistent',
            'practise': 'practice',
            'practis': 'practice',
            'foccus': 'focus',
            'focuss': 'focus',
            'tempos': 'tempo',
            'spead': 'speed',
            'speeds': 'speed',
            'endurence': 'endurance',
            'endurace': 'endurance',
            'techinque': 'technique',
            'technqiue': 'technique',
            'fillls': 'fills',
            'groov': 'groove',
            'patern': 'pattern',
            'pattrn': 'pattern',
            'creap': 'Creep',
            'creep': 'Creep',
            'paraniod': 'Paranoid',
            'parnoid': 'Paranoid'
        };

        // Common artists for song association (expand as needed)
        const knownArtists = {
            'Paranoid': 'Black Sabbath',
            'Master of Puppets': 'Metallica',
            'Seek & Destroy': 'Metallica',
            'Seven Nation Army': 'The White Stripes',
            'Running': 'OMA',
            'Friday I\'m In Love': 'The Cure',
            'Radioactive': 'Imagine Dragons',
            'I Will Survive': 'Gloria Gaynor',
            'Creep': 'Radiohead',
            'CREAM': 'OMA'
        };

        const examples = {
            charleigh: `Charleigh - Worked through Black sabath Paranoid which i sent home through the app. you did great with it, went over some of the 16s fills which brough us into playing 16s to a metronome! (classic) Startwed at 100bpm and worked it up to 170. great job, try to keep everything nice and balanced, while maintaining even strokes! then we started to learned Running by oma. this will help with working on your kick indepence, breaking the bond your right hand and right foot naturally have. this busy beat has a lot of kick in between you hh 8th, so keep steady with this one`,
            morgan: `Morgan - Worked through The Cure - Friday I'm In Love most of the episode. We played through first at 90% speed then cranked it out at full. great job with this, spoke about technique with hh and keeping it light so we can play through the whole song. keep your kick nice and steady with the rhthm, after a bit can start to miss. try tp stay focused and keep this beat and driving! great job Again, to keep endurance try to stay lite on your right hand.`,
            luca: `Luca - Went through triplets from 60-70bpm. doing great, try for 80 next week. played through seven nation army, just the chorus to work on. played through radioactive which sounds very good! lastly we started to learn i will survive. nice work!`,
            conan: `Conan - Worked through bosa nova, playing it to a couple different songs but looking to keep it nice and consistent. Then we broke into master of puppets by metalica and worked out some of the timing. sounding really good its a come a long way. lastly we went through some foot techniques.`,
            amaiyah: `Amaiyah - worked through creep, broke down the main patterns including the cross stick at the end. Went through learning sixtuplets and played them over the song CREAM by oma. Nice work with these. for sticking its 6 hits on the snare then 2, 2, 2 startingon the snare, tom, low tom. Sorry for going over your time, we spoke about what kind of drum kit to get which i suggest to not spend over $500 to start. A nice kit to start off with is Quest Loves Pocket kit or the breakbeats kit. You will need to get cymbals and hardware as well, which i would find used on facebook market place or ebay`,
            seek: `Started learning Seek & Destroy by Metallica. Mapped out the song structure and began working through the main groove with single strokes. Keep practicing the single-stroke groove slowly, making sure it stays steady and even. Review the mapped-out sections of the song and try playing along with the track at a reduced speed. Focus on consistency — clear hits and solid timing.`
        };

        function fixSpelling(text) {
            let fixed = text.toLowerCase();  // Work in lowercase for matching
            
            // Fix common misspellings
            for (const [wrong, right] of Object.entries(spellFixes)) {
                const regex = new RegExp('\\b' + wrong + '\\b', 'gi');
                fixed = fixed.replace(regex, right.toLowerCase());
            }
            
            // Expand music terms
            for (const [abbrev, full] of Object.entries(musicTerms)) {
                const regex = new RegExp('\\b' + abbrev + '\\b', 'gi');
                fixed = fixed.replace(regex, full.toLowerCase());
            }
            
            return fixed;
        }

        function capitalizeProperly(text) {
            // Capitalize first letter, and proper nouns/artists/songs
            text = text.charAt(0).toUpperCase() + text.slice(1);
            // Capitalize known artists and terms
            Object.values(knownArtists).forEach(artist => {
                const regex = new RegExp('\\b' + artist.toLowerCase() + '\\b', 'gi');
                text = text.replace(regex, artist);
            });
            Object.keys(knownArtists).forEach(song => {
                const regex = new RegExp('\\b' + song.toLowerCase() + '\\b', 'gi');
                text = text.replace(regex, song);
            });
            return text;
        }

        function extractSongs(text) {
            const songs = [];
            
            // Improved patterns to capture song and optional artist
            const patterns = [
                /played? (?:through |on |with )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|focusing|most)/gi,
                /worked? (?:through |on |with )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which|most|focusing)/gi,
                /started? (?:to learn |learning )?["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which)/gi,
                /learned? ["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which)/gi,
                /ran ["']?(.+?)(?: by (.+?))?["']?(?:,|\.|which)/gi
            ];
            
            patterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    let song = match[1].trim();
                    let artist = match[2] ? match[2].trim() : knownArtists[song] || '';
                    
                    // Clean up song name
                    song = capitalizeProperly(song.replace(/^(the |a |an )/i, ''));
                    
                    if (song && !song.match(/^(it|this|that|them|through|on|with)$/i)) {
                        songs.push({ song, artist });
                    }
                }
            });
            
            // Deduplicate by song name
            const uniqueSongs = new Map();
            songs.forEach(s => uniqueSongs.set(s.song.toLowerCase(), s));
            return Array.from(uniqueSongs.values());
        }

        function extractTechniques(text) {
            const techniques = new Set();
            const techPatterns = [
                /(\d+)\s*(?:-\s*)?(\d+)?\s*bpm/gi,
                /triplet[s]?/gi,
                /sixtuplet[s]?|sextuplet[s]?/gi,
                /16th[\s-]?note[s]?|16s|16th[s]?/gi,
                /8th[\s-]?note[s]?|8s|8th[s]?/gi,
                /cross[\s-]?stick/gi,
                /kick[\s-]?(?:drum|independence|pattern)?/gi,
                /hi[\s-]?hat|hh/gi,
                /foot[\s-]?(?:technique[s]?|work)/gi,
                /fill[s]?/gi,
                /groove[s]?|beat[s]?|pattern[s]?/gi,
                /bossa[\s-]?nova/gi,
                /endurance|stamina/gi,
                /single[\s-]?stroke/gi,
                /double[\s-]?stroke/gi,
                /rudiment[s]?/gi,
                /paradiddle[s]?/gi,
                /flam[s]?/gi,
                /drag[s]?/gi,
                /roll[s]?/gi,
                /buzz[\s-]?roll/gi,
                /independence/gi,
                /metronome/gi
            ];
            
            techPatterns.forEach(pattern => {
                let match;
                while ((match = pattern.exec(text)) !== null) {
                    techniques.add(match[0].toLowerCase());
                }
            });
            
            return Array.from(techniques);
        }

        function classifySentence(sentence, songs, techniques) {
            const lower = sentence.toLowerCase();
            
            // Achievement indicators
            const achIndicators = ['worked', 'played', 'went', 'learned', 'started', 'practiced', 'focused', 'spent', 'ran', 'broke', 'mapped', 'began'];
            if (achIndicators.some(ind => lower.includes(ind))) {
                return 'achievement';
            }
            
            // Homework indicators
            const hwIndicators = ['try', 'keep', 'practice', 'work on', 'focus on', 'aim for', 'next week', 'homework', 'review', 'continue', 'build'];
            if (hwIndicators.some(ind => lower.includes(ind))) {
                return 'homework';
            }
            
            // Fallback: if mentions song or technique, likely achievement
            if (songs.some(s => lower.includes(s.song.toLowerCase())) || techniques.some(t => lower.includes(t))) {
                return 'achievement';
            }
            
            return 'other';
        }

        function formatAchievement(sentence, songs) {
            let formatted = capitalizeProperly(sentence);
            
            // Remove leading verbs if needed for conciseness
            formatted = formatted.replace(/^(We |Then we |Lastly we |First we )/i, '');
            
            // Adjust pronouns to third person
            formatted = formatted.replace(/\bwe\b/gi, 'They');
            formatted = formatted.replace(/\bi\b/gi, 'the instructor');
            formatted = formatted.replace(/\byou\b/gi, 'they');
            formatted = formatted.replace(/\byour\b/gi, 'their');
            
            // Add quotes and artists to songs
            songs.forEach(({ song, artist }) => {
                const songRegex = new RegExp('\\b' + song.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                const replacement = artist ? `“${song}” (${artist})` : `“${song}”`;
                formatted = formatted.replace(songRegex, replacement);
            });
            
            // Ensure ends with period if not
            if (!formatted.match(/[.!?]$/)) {
                formatted += '.';
            }
            
            return `* ${formatted}`;
        }

        function formatHomework(sentence, songs, techniques) {
            let formatted = capitalizeProperly(sentence);
            
            // Make imperative
            formatted = formatted.replace(/^try (?:to |for )/i, '');
            formatted = formatted.replace(/^keep /i, 'Keep ');
            formatted = formatted.replace(/^practice /i, 'Practice ');
            formatted = formatted.replace(/^work on /i, 'Work on ');
            formatted = formatted.replace(/^focus on /i, 'Focus on ');
            formatted = formatted.replace(/^review /i, 'Review ');
            formatted = formatted.replace(/^continue /i, 'Continue ');
            
            // Adjust pronouns to second person (student-facing)
            formatted = formatted.replace(/\bthey\b/gi, 'you');
            formatted = formatted.replace(/\btheir\b/gi, 'your');
            
            // Add song quotes
            songs.forEach(({ song, artist }) => {
                const songRegex = new RegExp('\\b' + song.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                const replacement = artist ? `“${song}” (${artist})` : `“${song}”`;
                formatted = formatted.replace(songRegex, replacement);
            });
            
            // Enhance with common phrases if short
            if (formatted.length < 20) {
                formatted = `Keep working on ${formatted.toLowerCase()}.`;
            }
            
            // Ensure ends with period
            if (!formatted.match(/[.!?]$/)) {
                formatted += '.';
            }
            
            return `* ${formatted}`;
        }

        function generateInferredHomework(songs, techniques, achievements) {
            const hw = [];
            
            if (songs.length > 0) {
                songs.forEach(({ song, artist }) => {
                    const fullSong = artist ? `“${song}” (${artist})` : `“${song}”`;
                    hw.push(`* Review and practice ${fullSong} at a comfortable speed.`);
                });
            }
            
            if (techniques.length > 0) {
                hw.push('* Focus on technique: work on ' + techniques.slice(0, 3).join(', ') + ' with a metronome.');
            }
            
            if (achievements.some(a => a.toLowerCase().includes('bpm'))) {
                hw.push('* Build up speed gradually while maintaining accuracy.');
            }
            
            if (achievements.some(a => a.toLowerCase().includes('endurance'))) {
                hw.push('* Practice endurance by playing through full sections without stopping.');
            }
            
            if (hw.length === 0) {
                hw.push('* Continue practicing this week’s material with focus on timing and consistency.');
            }
            
            return hw;
        }

        function extractExtraNote(cleanText) {
            let extraNote = '';
            
            // Equipment discussion
            const kitRegex = /(?:spoke|talked|discussed|suggest|recommend).*?(?:drum kit|equipment|gear|kit|cymbals|hardware).*?(?:\.|$)/gi;
            const kitMatch = cleanText.match(kitRegex);
            if (kitMatch) {
                extraNote = kitMatch.map(m => 
                    capitalizeProperly(m.replace(/^(?:spoke|talked|discussed) (?:about|on) /i, 'Discussed '))
                ).join(' ');
                
                // Add price if mentioned
                const priceMatch = cleanText.match(/\$(\d+)/);
                if (priceMatch) {
                    extraNote += ` Suggested budget under $${priceMatch[1]}.`;
                }
                
                // Specific kits
                const kits = ['Questlove\'s Pocket Kit', 'Breakbeats Kit'];
                kits.forEach(kit => {
                    if (cleanText.toLowerCase().includes(kit.toLowerCase())) {
                        extraNote += ` Recommended ${kit}.`;
                    }
                });
                
                // Used sources
                if (cleanText.toLowerCase().includes('facebook') || cleanText.toLowerCase().includes('marketplace') || cleanText.toLowerCase().includes('ebay')) {
                    extraNote += ' Look for used options on Facebook Marketplace or eBay.';
                }
            }
            
            // Time overrun
            if (cleanText.toLowerCase().includes('sorry for going over')) {
                extraNote += ' Apologies for running over time.';
            }
            
            return extraNote.trim();
        }

        function formatNotes() {
            const input = document.getElementById('lessonNotes').value.trim();
            if (!input) {
                alert('Please enter lesson notes to format');
                return;
            }
            
            // Extract student name if present
            const studentMatch = input.match(/^(\w+)\s*[-:]/);
            const studentName = studentMatch ? studentMatch[1] : '';
            
            // Clean the text
            let cleanText = input.replace(/^(\w+)\s*[-:]/, '').trim();  // Remove student name
            cleanText = fixSpelling(cleanText);
            
            // Extract key info
            const songs = extractSongs(cleanText);
            const techniques = extractTechniques(cleanText);
            
            // Split into sentences, handling more punctuation
            const sentences = cleanText
                .replace(/([.!?])\s*/g, '$1|')  // Mark sentence ends
                .split('|')
                .map(s => s.trim())
                .filter(s => s);
            
            // Classify and collect
            const achievements = [];
            const homework = [];
            sentences.forEach(s => {
                const type = classifySentence(s, songs, techniques);
                if (type === 'achievement') {
                    achievements.push(formatAchievement(s, songs));
                } else if (type === 'homework') {
                    homework.push(formatHomework(s, songs));
                }
            });
            
            // Infer homework if none or few detected
            if (homework.length < 2) {
                const inferred = generateInferredHomework(songs, techniques, achievements);
                inferred.forEach(h => {
                    if (!homework.includes(h)) {
                        homework.push(h);
                    }
                });
            }
            
            // Extract extra note
            const extraNote = extractExtraNote(cleanText);
            
            // Build output
            let output = 'Today’s Achievements\n\n';
            
            if (achievements.length > 0) {
                output += achievements.join('\n') + '\n\n';
            } else {
                output += '* Worked through lesson material';
                if (studentName) output += ` with ${studentName}`;
                output += '.\n';
                if (songs.length > 0) {
                    const songList = songs.map(({ song, artist }) => artist ? `“${song}” (${artist})` : `“${song}”`).join(', ');
                    output += `* Practiced songs including ${songList}.\n`;
                }
                if (techniques.length > 0) {
                    output += '* Focused on techniques such as ' + techniques.join(', ') + '.\n\n';
                }
            }
            
            output += 'Homework\n\n';
            
            if (homework.length > 0) {
                output += homework.join('\n');
            } else {
                output += '* Review this week’s material.\n';
                output += '* Practice daily with a focus on technique and tempo.';
            }
            
            if (extraNote) {
                output += '\n\nExtra Note\n\n' + `* ${capitalizeProperly(extraNote)}`;
            }
            
            document.getElementById('output').textContent = output;
        }

        function loadExample(exampleKey) {
            const textarea = document.getElementById('lessonNotes');
            textarea.value = examples[exampleKey];
        }

        function clearAll() {
            document.getElementById('lessonNotes').value = '';
            document.getElementById('output').textContent = 'Formatted notes will appear here...';
        }

        function copyOutput() {
            const outputText = document.getElementById('output').innerText;
            navigator.clipboard.writeText(outputText).then(() => {
                alert('Output copied to clipboard!');
            }).catch(err => {
                alert('Failed to copy text');
            });
        }
    </script>
</body>
</html>
