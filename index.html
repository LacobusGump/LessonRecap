<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drum Lesson Formatter</title>
    <style>
        :root {
            --f1: 1px;
            --f2: 2px;
            --f3: 3px;
            --f5: 5px;
            --f8: 8px;
            --f13: 13px;
            --f21: 21px;
            --f34: 34px;
            --f55: 55px;
            --f89: 89px;
            
            --bg: #0a0a0a;
            --surface: #141414;
            --border: #262626;
            --text: #f0f0f0;
            --dim: #888;
            --accent: #3b82f6;
            --success: #22c55e;
            --error: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.618;
            font-size: 14px;
            padding: var(--f21);
            max-width: 987px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: var(--f21);
            font-weight: 500;
            margin-bottom: var(--f34);
            letter-spacing: -0.02em;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--f21);
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
        
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--f8);
            padding: var(--f21);
        }
        
        label {
            display: block;
            margin-bottom: var(--f8);
            font-size: 12px;
            color: var(--dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        input, textarea, select {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--f5);
            padding: var(--f8) var(--f13);
            color: var(--text);
            font: inherit;
            transition: border-color 0.2s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        textarea {
            min-height: 144px;
            resize: vertical;
            line-height: 1.618;
        }
        
        button {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--f5);
            padding: var(--f8) var(--f21);
            font: inherit;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:hover { opacity: 0.9; }
        button:active { transform: translateY(1px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        button.secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }
        
        button.secondary:hover { background: var(--border); }
        
        .btn-group {
            display: flex;
            gap: var(--f8);
            margin-top: var(--f13);
            flex-wrap: wrap;
        }
        
        .btn-group button { flex: 1; min-width: 89px; }
        
        /* Beat Grid */
        .beat-grid {
            display: grid;
            grid-template-columns: var(--f55) repeat(16, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: var(--f5);
            overflow: hidden;
            margin: var(--f13) 0;
        }
        
        .beat-label {
            background: var(--surface);
            padding: var(--f5);
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            color: var(--dim);
        }
        
        .beat-cell {
            aspect-ratio: 1;
            background: var(--surface);
            cursor: pointer;
            transition: background 0.1s;
            position: relative;
        }
        
        .beat-cell:hover { background: var(--border); }
        .beat-cell.active { background: var(--accent); }
        .beat-cell.accent-beat::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--dim);
        }
        
        /* Notation Display */
        .notation {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--f5);
            padding: var(--f13);
            margin: var(--f13) 0;
            white-space: pre;
            line-height: 1.4;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .output {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--f5);
            padding: var(--f21);
            min-height: 233px;
            white-space: pre-wrap;
            line-height: 1.618;
        }
        
        .output.final {
            border-color: var(--success);
            position: relative;
        }
        
        .output.final::before {
            content: 'FINALIZED';
            position: absolute;
            top: var(--f8);
            right: var(--f8);
            font-size: 10px;
            color: var(--success);
            letter-spacing: 0.1em;
        }
        
        /* Messages */
        .msg {
            padding: var(--f8) var(--f13);
            border-radius: var(--f5);
            margin-top: var(--f13);
            font-size: 12px;
            display: none;
        }
        
        .msg.show { display: block; }
        .msg.success { background: rgba(34, 197, 94, 0.1); color: var(--success); }
        .msg.error { background: rgba(239, 68, 68, 0.1); color: var(--error); }
        
        /* Examples */
        .examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(144px, 1fr));
            gap: var(--f5);
            margin-top: var(--f13);
        }
        
        .example-btn {
            padding: var(--f5) var(--f8);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--f3);
            color: var(--dim);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .example-btn:hover {
            color: var(--text);
            border-color: var(--accent);
        }
        
        /* Utilities */
        .section { margin-bottom: var(--f21); }
        .small { font-size: 11px; color: var(--dim); }
        .counter { text-align: right; margin-top: var(--f5); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .processing { animation: pulse 1s infinite; }
    </style>
</head>
<body>
    <h1>Drum Lesson Formatter</h1>
    
    <div class="grid">
        <div class="card">
            <div class="section">
                <label>Student</label>
                <input type="text" id="student" placeholder="Name">
            </div>
            
            <div class="section">
                <label>Notes</label>
                <textarea id="notes" placeholder="Worked on paradiddles at 120bpm, practiced kick independence..."></textarea>
                <div class="small counter"><span id="charCount">0</span> / 2000</div>
            </div>
            
            <div class="section">
                <label>Beat Pattern</label>
                <div class="beat-grid" id="beatGrid"></div>
                <div class="notation" id="notation">Click cells to create pattern</div>
                <div class="btn-group">
                    <button class="secondary" onclick="clearPattern()">Clear</button>
                    <button class="secondary" onclick="presetBeat('basic')">Basic</button>
                    <button class="secondary" onclick="presetBeat('funk')">Funk</button>
                    <button class="secondary" onclick="addPatternToNotes()">Add to Notes</button>
                </div>
            </div>
            
            <div class="section">
                <label>Examples</label>
                <div class="examples">
                    <button class="example-btn" onclick="loadExample(0)">Basic Lesson</button>
                    <button class="example-btn" onclick="loadExample(1)">Song Practice</button>
                    <button class="example-btn" onclick="loadExample(2)">Technique Focus</button>
                    <button class="example-btn" onclick="loadExample(3)">Advanced</button>
                </div>
            </div>
            
            <div class="btn-group">
                <button onclick="generate()">Generate</button>
                <button class="secondary" onclick="clearAll()">Clear</button>
            </div>
            
            <div class="msg" id="msg"></div>
        </div>
        
        <div class="card">
            <label>Output</label>
            <div class="output" id="output">Formatted lesson will appear here...</div>
            <div class="btn-group">
                <button class="secondary" onclick="copyOutput()">Copy</button>
                <button class="secondary" onclick="finalize()">Finalize</button>
            </div>
        </div>
    </div>

    <script>
        // Drum parts and pattern storage
        const parts = ['HH', 'SD', 'BD'];
        let pattern = {};
        let finalized = false;
        
        // Music terms dictionary
        const terms = {
            'hh': 'hi-hat', 'hihat': 'hi-hat', 'bd': 'bass drum', 'kick': 'kick drum',
            'sd': 'snare drum', 'snare': 'snare drum', '16s': '16th notes', '8s': '8th notes',
            'bpm': 'BPM', 'paradiddle': 'paradiddle', 'flam': 'flam', 'drag': 'drag',
            'metalica': 'Metallica', 'sabbath': 'Sabbath', 'paraniod': 'Paranoid'
        };
        
        // Song database
        const songs = {
            'paranoid': 'Paranoid by Black Sabbath',
            'enter sandman': 'Enter Sandman by Metallica',
            'back in black': 'Back In Black by AC/DC',
            'smells like teen spirit': 'Smells Like Teen Spirit by Nirvana',
            'seven nation army': 'Seven Nation Army by The White Stripes'
        };
        
        // Examples
        const examples = [
            { student: 'Alex', notes: 'Worked on basic 4/4 beat at 100bpm. Focus on keeping steady kick drum and hi-hat eighth notes. Snare on 2 and 4.' },
            { student: 'Morgan', notes: 'Played through Seven Nation Army. Good timing on the main beat, work on fills between sections. Try adding ghost notes on snare.' },
            { student: 'Sam', notes: 'Practiced paradiddles starting at 80bpm up to 120bpm. Right hand lead feels strong. Work on left hand consistency.' },
            { student: 'Jordan', notes: 'Advanced session: polyrhythmic patterns, 5/4 time signature exploration, worked on Meshuggah-style grooves with displaced accents.' }
        ];
        
        // Initialize beat grid
        function initGrid() {
            const grid = document.getElementById('beatGrid');
            grid.innerHTML = '';
            
            parts.forEach(part => {
                pattern[part] = new Array(16).fill(false);
                
                // Add label
                const label = document.createElement('div');
                label.className = 'beat-label';
                label.textContent = part;
                grid.appendChild(label);
                
                // Add cells
                for (let i = 0; i < 16; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'beat-cell';
                    if (i % 4 === 0) cell.classList.add('accent-beat');
                    cell.dataset.part = part;
                    cell.dataset.beat = i;
                    cell.onclick = toggleCell;
                    grid.appendChild(cell);
                }
            });
            
            updateNotation();
        }
        
        // Toggle beat cell
        function toggleCell(e) {
            const { part, beat } = e.target.dataset;
            pattern[part][beat] = !pattern[part][beat];
            e.target.classList.toggle('active');
            updateNotation();
        }
        
        // Update notation display
        function updateNotation() {
            let notation = '4/4 Time - 16th Notes\n\n';
            const dividers = '|----|----|----|----|';
            
            parts.forEach(part => {
                notation += `${part}: |`;
                for (let i = 0; i < 16; i++) {
                    notation += pattern[part][i] ? 'x' : '-';
                    if ((i + 1) % 4 === 0 && i < 15) notation += '|';
                }
                notation += '|\n';
            });
            
            notation += '    ' + dividers + '\n';
            notation += '     1 e & a 2 e & a 3 e & a 4 e & a';
            
            document.getElementById('notation').textContent = notation;
        }
        
        // Clear pattern
        function clearPattern() {
            document.querySelectorAll('.beat-cell.active').forEach(cell => {
                cell.classList.remove('active');
            });
            parts.forEach(part => pattern[part].fill(false));
            updateNotation();
            showMsg('Pattern cleared', 'success');
        }
        
        // Load preset beats
        function presetBeat(type) {
            clearPattern();
            
            const presets = {
                basic: {
                    HH: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],
                    SD: [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
                    BD: [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
                },
                funk: {
                    HH: [1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0],
                    SD: [0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0],
                    BD: [1,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0]
                }
            };
            
            const preset = presets[type];
            parts.forEach(part => {
                preset[part].forEach((val, i) => {
                    pattern[part][i] = val === 1;
                    if (val === 1) {
                        document.querySelector(`[data-part="${part}"][data-beat="${i}"]`).classList.add('active');
                    }
                });
            });
            
            updateNotation();
            showMsg(`${type} beat loaded`, 'success');
        }
        
        // Add pattern to notes
        function addPatternToNotes() {
            const hasPattern = parts.some(part => pattern[part].some(v => v));
            if (!hasPattern) {
                showMsg('Create a pattern first', 'error');
                return;
            }
            const notation = document.getElementById('notation').textContent;
            document.getElementById('notes').value += '\n\nDrum Pattern:\n' + notation;
            updateCharCount();
            showMsg('Pattern added to notes', 'success');
        }
        
        // Process text
        function processText(text) {
            if (!text) return '';
            
            // Fix common misspellings and abbreviations
            Object.entries(terms).forEach(([key, val]) => {
                const regex = new RegExp(`\\b${key}\\b`, 'gi');
                text = text.replace(regex, val);
            });
            
            // Identify and format songs
            Object.entries(songs).forEach(([key, val]) => {
                const regex = new RegExp(`\\b${key}\\b`, 'gi');
                text = text.replace(regex, val);
            });
            
            // Fix capitalization
            text = text.replace(/\. ([a-z])/g, (m, p1) => `. ${p1.toUpperCase()}`);
            text = text.charAt(0).toUpperCase() + text.slice(1);
            
            return text;
        }
        
        // Generate formatted output
        function generate() {
            const student = document.getElementById('student').value.trim();
            const notes = document.getElementById('notes').value.trim();
            
            if (!notes) {
                showMsg('Please enter lesson notes', 'error');
                return;
            }
            
            const processed = processText(notes);
            const sentences = processed.match(/[^.!?]+[.!?]/g) || [];
            
            // Extract achievements and homework
            const achievements = [];
            const homework = [];
            const techniques = new Set();
            
            // Find techniques mentioned
            ['BPM', 'paradiddle', 'fill', 'groove', 'independence', 'ghost note', '16th notes', '8th notes']
                .forEach(tech => {
                    if (processed.toLowerCase().includes(tech.toLowerCase())) {
                        techniques.add(tech);
                    }
                });
            
            // Classify sentences
            sentences.forEach(s => {
                const lower = s.toLowerCase();
                if (lower.includes('worked') || lower.includes('played') || lower.includes('practiced')) {
                    achievements.push('• ' + s.trim());
                } else if (lower.includes('try') || lower.includes('work on') || lower.includes('focus')) {
                    homework.push('• ' + s.trim());
                }
            });
            
            // Build output
            let output = `LESSON RECAP${student ? ' - ' + student : ''}\n`;
            output += `Date: ${new Date().toLocaleDateString()}\n\n`;
            
            output += 'TODAY\'S ACHIEVEMENTS:\n';
            if (achievements.length) {
                output += achievements.join('\n');
            } else {
                output += '• Completed lesson objectives\n• Showed good progress';
            }
            
            output += '\n\nPRACTICE ASSIGNMENTS:\n';
            if (homework.length) {
                output += homework.join('\n');
            } else {
                output += '• Continue practicing material from today\n• Focus on maintaining steady tempo';
            }
            
            if (techniques.size) {
                output += '\n\nTECHNIQUES COVERED:\n';
                Array.from(techniques).forEach(t => {
                    output += `• ${t}\n`;
                });
            }
            
            // Add notation if pattern exists
            const hasPattern = parts.some(part => pattern[part].some(v => v));
            if (hasPattern) {
                output += '\n\nDRUM NOTATION:\n' + document.getElementById('notation').textContent;
            }
            
            document.getElementById('output').textContent = output;
            finalized = false;
            document.getElementById('output').classList.remove('final');
            showMsg('Recap generated!', 'success');
        }
        
        // Finalize output
        function finalize() {
            if (finalized) {
                showMsg('Already finalized', 'error');
                return;
            }
            document.getElementById('output').classList.add('final');
            finalized = true;
            
            // Save to localStorage
            const student = document.getElementById('student').value.trim() || 'Unknown';
            const history = JSON.parse(localStorage.getItem('lessonHistory') || '{}');
            if (!history[student]) history[student] = [];
            history[student].push({
                date: new Date().toISOString(),
                content: document.getElementById('output').textContent
            });
            localStorage.setItem('lessonHistory', JSON.stringify(history));
            
            showMsg('Finalized and saved!', 'success');
        }
        
        // Copy output
        function copyOutput() {
            const text = document.getElementById('output').textContent;
            if (text === 'Formatted lesson will appear here...') {
                showMsg('Nothing to copy', 'error');
                return;
            }
            navigator.clipboard.writeText(text);
            showMsg('Copied!', 'success');
        }
        
        // Clear all
        function clearAll() {
            document.getElementById('student').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('output').textContent = 'Formatted lesson will appear here...';
            document.getElementById('output').classList.remove('final');
            clearPattern();
            finalized = false;
            updateCharCount();
        }
        
        // Load example
        function loadExample(idx) {
            const ex = examples[idx];
            document.getElementById('student').value = ex.student;
            document.getElementById('notes').value = ex.notes;
            updateCharCount();
            showMsg('Example loaded', 'success');
        }
        
        // Show message
        function showMsg(text, type) {
            const msg = document.getElementById('msg');
            msg.textContent = text;
            msg.className = `msg ${type} show`;
            setTimeout(() => msg.classList.remove('show'), 3000);
        }
        
        // Update character count
        function updateCharCount() {
            const count = document.getElementById('notes').value.length;
            document.getElementById('charCount').textContent = count;
            document.getElementById('charCount').style.color = count > 1800 ? 'var(--error)' : 'var(--dim)';
        }
        
        // Initialize
        initGrid();
        document.getElementById('notes').addEventListener('input', updateCharCount);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'Enter') { e.preventDefault(); generate(); }
                if (e.key === 's') { e.preventDefault(); finalize(); }
                if (e.key === 'd') { e.preventDefault(); clearAll(); }
            }
        });
    </script>
</body>
</html>
