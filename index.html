<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School of Rock - Lesson Formatter</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .panel-header {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #6c757d;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 500px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            line-height: 1.6;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        #output {
            width: 100%;
            min-height: 500px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            line-height: 1.8;
            white-space: pre-wrap;
            background: #f8f9fa;
            overflow-y: auto;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-secondary:hover {
            background: #dee2e6;
        }
        
        .examples {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .example {
            padding: 6px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .example:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        @media (max-width: 768px) {
            .workspace {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¸ School of Rock Lesson Formatter</h1>
            <p>Transform your lesson notes into professional recaps</p>
        </div>
        
        <div class="workspace">
            <div class="panel">
                <div class="panel-header">Raw Notes</div>
                <textarea id="input" placeholder="Example: Sarah - worked on Come As You Are by Nirvana, getting the main riff down. Also started Hey Joe by hendrix. practice slowly with metronome at 80bpm then build up speed"></textarea>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="formatLesson()">
                        Format âœ¨
                    </button>
                    <button class="btn btn-secondary" onclick="clearInput()">
                        Clear
                    </button>
                </div>
                <div class="examples">
                    <span class="example" onclick="loadExample(1)">Metal/Timing</span>
                    <span class="example" onclick="loadExample(2)">Pop/Endurance</span>
                    <span class="example" onclick="loadExample(3)">Beginner/Multiple</span>
                    <span class="example" onclick="loadExample(4)">Jazz/Technique</span>
                    <span class="example" onclick="loadExample(5)">Punk/Speed</span>
                    <span class="example" onclick="loadExample(6)">Modern/Grooves</span>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">Formatted Output</div>
                <div id="output">Your formatted lesson recap will appear here...</div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="copyToClipboard()">
                        ðŸ“‹ Copy
                    </button>
                    <button class="btn btn-secondary" onclick="downloadText()">
                        ðŸ’¾ Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SmartLessonFormatter {
            constructor() {
                // Common spelling mistakes to fix
                this.corrections = {
                    'metalica': 'Metallica',
                    'metalicca': 'Metallica',
                    'beetles': 'Beatles',
                    'sabbeth': 'Sabbath',
                    'sabath': 'Sabbath',
                    'zepplin': 'Zeppelin',
                    'zeplin': 'Zeppelin',
                    'hendrix': 'Hendrix',
                    'rhcp': 'Red Hot Chili Peppers',
                    'gnr': "Guns N' Roses",
                    'acdc': 'AC/DC',
                    'ac dc': 'AC/DC',
                    'bosa nova': 'bossa nova',
                    'bosa': 'bossa',
                    'hh': 'hi-hat',
                    'hihat': 'hi-hat',
                    '16s': '16th notes',
                    '16ths': '16th notes',
                    '8s': '8th notes',
                    '8ths': '8th notes',
                    'tp': 'to',
                    'lite': 'light',
                    'rhthm': 'rhythm',
                    'rythm': 'rhythm',
                    'sixtuplets': 'sextuplets',
                    'triplet': 'triplets'
                };
                
                // Pattern indicators for music context
                this.musicIndicators = [
                    'by', 'played', 'worked', 'learned', 'practiced', 
                    'covered', 'song', 'tune', 'piece', 'track'
                ];
                
                // Common technique keywords
                this.techniques = [
                    'metronome', 'bpm', 'tempo', 'timing', 'rhythm',
                    'fills', 'groove', 'grooves', 'beat', 'pattern',
                    'technique', 'techniques', 'independence', 'coordination',
                    'dynamics', 'accents', 'ghost notes', 'flams',
                    'paradiddles', 'rudiments', 'sticking', 'speed',
                    'endurance', 'stamina', 'control', 'precision'
                ];
            }
            
            format(input) {
                if (!input || input.trim().length < 10) {
                    return 'Please enter your lesson notes...';
                }
                
                // Step 1: Clean and prepare text
                let text = this.cleanText(input);
                
                // Step 2: Extract student name
                const studentName = this.extractStudentName(text);
                text = text.replace(/^[^-:]*[-:]/, '').trim();
                
                // Step 3: Extract all the data
                const songs = this.extractSongs(text);
                const techniques = this.extractTechniques(text);
                const homework = this.extractHomework(text, songs, techniques);
                
                // Step 4: Build the formatted output
                return this.buildOutput(studentName, songs, techniques, homework);
            }
            
            cleanText(text) {
                // Apply corrections
                let cleaned = text;
                for (const [wrong, right] of Object.entries(this.corrections)) {
                    const regex = new RegExp(`\\b${wrong}\\b`, 'gi');
                    cleaned = cleaned.replace(regex, right);
                }
                
                // Fix spacing around punctuation
                cleaned = cleaned
                    .replace(/\s+/g, ' ')
                    .replace(/\s*([,.!?])/g, '$1')
                    .replace(/([,.!?])([A-Za-z])/g, '$1 $2');
                
                return cleaned;
            }
            
            extractStudentName(text) {
                const match = text.match(/^([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)\s*[-:]/i);
                return match ? match[1] : '';
            }
            
            extractSongs(text) {
                const songs = [];
                
                // Pattern 1: "Song Title" by Artist
                const pattern1 = /"([^"]+)"\s+by\s+([A-Z][^,.!?]+)/gi;
                let match;
                while ((match = pattern1.exec(text)) !== null) {
                    songs.push({
                        title: match[1].trim(),
                        artist: this.cleanArtistName(match[2].trim())
                    });
                }
                
                // Pattern 2: Song by Artist (without quotes)
                const pattern2 = /(?:played|worked on|learned|practiced|covered|started)\s+([A-Z][^,]+?)\s+by\s+([A-Z][^,.!?]+)/gi;
                while ((match = pattern2.exec(text)) !== null) {
                    const title = match[1].trim();
                    if (!songs.some(s => s.title.toLowerCase() === title.toLowerCase())) {
                        songs.push({
                            title: this.cleanSongTitle(title),
                            artist: this.cleanArtistName(match[2].trim())
                        });
                    }
                }
                
                // Pattern 3: Artist - Song format
                const pattern3 = /([A-Z][^-,]+?)\s*-\s*([A-Z][^,.!?]+?)(?:\.|,|!|\?|$)/gi;
                while ((match = pattern3.exec(text)) !== null) {
                    const possibleArtist = match[1].trim();
                    const possibleSong = match[2].trim();
                    
                    // Check if this looks like artist - song (not student - notes)
                    if (this.looksLikeMusic(possibleArtist) || this.looksLikeMusic(possibleSong)) {
                        if (!songs.some(s => s.title.toLowerCase() === possibleSong.toLowerCase())) {
                            songs.push({
                                title: this.cleanSongTitle(possibleSong),
                                artist: this.cleanArtistName(possibleArtist)
                            });
                        }
                    }
                }
                
                // Pattern 4: Just song titles after music verbs
                const pattern4 = /(?:played|worked on|learned|practiced|covered|started|did)\s+([A-Z][^,.]+?)(?:\.|,|and|also|then)/gi;
                while ((match = pattern4.exec(text)) !== null) {
                    const title = match[1].trim();
                    // Only add if it doesn't contain "by" (those are caught above)
                    if (!title.includes(' by ') && !songs.some(s => s.title.toLowerCase() === title.toLowerCase())) {
                        // Check if next words might be "by Artist"
                        const afterMatch = text.slice(match.index + match[0].length);
                        const byArtist = afterMatch.match(/^\s*by\s+([A-Z][^,.!?]+)/i);
                        
                        if (byArtist) {
                            songs.push({
                                title: this.cleanSongTitle(title),
                                artist: this.cleanArtistName(byArtist[1].trim())
                            });
                        } else if (this.looksLikeSongTitle(title)) {
                            songs.push({
                                title: this.cleanSongTitle(title),
                                artist: ''
                            });
                        }
                    }
                }
                
                return this.deduplicateSongs(songs);
            }
            
            extractTechniques(text) {
                const found = [];
                const lowerText = text.toLowerCase();
                
                // Look for BPM/tempo mentions
                const bpmMatch = text.match(/\d+\s*(?:bpm|BPM)/g);
                if (bpmMatch) {
                    found.push(...bpmMatch);
                }
                
                // Look for technique keywords
                this.techniques.forEach(technique => {
                    if (lowerText.includes(technique.toLowerCase())) {
                        found.push(technique);
                    }
                });
                
                // Look for specific patterns
                if (/16th notes?|16s/i.test(text)) found.push('16th notes');
                if (/8th notes?|8s/i.test(text)) found.push('8th notes');
                if (/triplets?/i.test(text)) found.push('triplets');
                if (/sextuplets?|sixtuplets?/i.test(text)) found.push('sextuplets');
                if (/cross[- ]?stick/i.test(text)) found.push('cross-stick');
                if (/hi[- ]?hat/i.test(text)) found.push('hi-hat control');
                if (/kick|bass drum/i.test(text)) found.push('kick patterns');
                if (/bossa nova/i.test(text)) found.push('bossa nova');
                if (/foot technique/i.test(text)) found.push('foot technique');
                
                return [...new Set(found)];
            }
            
            extractHomework(text, songs, techniques) {
                const homework = [];
                
                // Look for explicit homework indicators
                const tryMatch = text.match(/try\s+(?:to\s+)?([^.!?]+)/gi);
                const keepMatch = text.match(/keep\s+([^.!?]+)/gi);
                const practiceMatch = text.match(/practice\s+([^.!?]+)/gi);
                const workOnMatch = text.match(/work\s+on\s+([^.!?]+)/gi);
                const focusMatch = text.match(/focus\s+on\s+([^.!?]+)/gi);
                
                // Generate homework based on content
                if (songs.length > 0) {
                    songs.slice(0, 2).forEach(song => {
                        const songRef = song.artist ? 
                            `***"${song.title}" (${song.artist})***` : 
                            `***"${song.title}"***`;
                        homework.push(`Play along with ${songRef} â€” focus on staying locked with the recording`);
                    });
                }
                
                // Add technique-based homework
                if (techniques.some(t => t.includes('bpm') || t.includes('BPM'))) {
                    const bpmValues = text.match(/\d+\s*(?:bpm|BPM)/g);
                    if (bpmValues) {
                        homework.push(`Continue metronome work at ${bpmValues.join(', ')} â€” gradually increase tempo as comfort improves`);
                    }
                }
                
                if (techniques.includes('16th notes')) {
                    homework.push('Practice 16th note patterns slowly first, then bring up to tempo');
                }
                
                if (techniques.includes('fills')) {
                    homework.push('Work on fills in isolation, then practice transitioning in and out smoothly');
                }
                
                if (techniques.includes('independence') || techniques.includes('coordination')) {
                    homework.push('Spend 5-10 minutes daily on independence exercises â€” start slow and focus on separation');
                }
                
                if (techniques.includes('endurance') || techniques.includes('stamina')) {
                    homework.push('Build endurance with longer practice sessions â€” remember to stay relaxed and use proper technique');
                }
                
                // Parse explicit instructions from text
                if (tryMatch || keepMatch || practiceMatch || workOnMatch || focusMatch) {
                    // Add specific instructions found in text
                    [tryMatch, keepMatch, practiceMatch, workOnMatch, focusMatch].forEach(matches => {
                        if (matches) {
                            matches.forEach(match => {
                                const instruction = match.replace(/^(try|keep|practice|work on|focus on)\s+/i, '');
                                if (instruction.length > 10 && instruction.length < 100) {
                                    homework.push(this.formatHomeworkItem(instruction));
                                }
                            });
                        }
                    });
                }
                
                // Ensure we have at least 2 homework items
                if (homework.length === 0) {
                    homework.push('Review today\'s material â€” focus on problem spots');
                    homework.push('Record yourself playing and listen back for areas to improve');
                }
                
                return [...new Set(homework)].slice(0, 5); // Max 5 items, no duplicates
            }
            
            buildOutput(studentName, songs, techniques, homework) {
                let output = '';
                
                // Add student name if present
                if (studentName) {
                    output += `**${studentName}**\n\n`;
                }
                
                output += '**Today\'s Achievements**\n';
                
                // Build achievements from songs and techniques
                if (songs.length > 0) {
                    songs.forEach(song => {
                        const songRef = song.artist ? 
                            `***"${song.title}" (${song.artist})***` : 
                            `***"${song.title}"***`;
                        output += `* Worked on ${songRef} â€” making solid progress through the arrangement\n`;
                    });
                }
                
                if (techniques.length > 0) {
                    // Group related techniques
                    const techGroups = this.groupTechniques(techniques);
                    techGroups.forEach(group => {
                        output += `* ${group}\n`;
                    });
                }
                
                // If no songs or techniques found, add generic achievement
                if (songs.length === 0 && techniques.length === 0) {
                    output += '* Focused practice session with good attention to detail\n';
                }
                
                output += '\n**Homework**\n';
                homework.forEach(item => {
                    output += `* ${item}\n`;
                });
                
                return output;
            }
            
            // Helper methods
            looksLikeMusic(text) {
                const lower = text.toLowerCase();
                return this.musicIndicators.some(indicator => lower.includes(indicator)) ||
                       /^[A-Z]/.test(text) && text.length > 2 && text.length < 50;
            }
            
            looksLikeSongTitle(text) {
                // Song titles typically start with capital letters and are 1-8 words
                const words = text.split(' ').length;
                return /^[A-Z]/.test(text) && words >= 1 && words <= 8 && 
                       !text.includes('worked') && !text.includes('played') &&
                       !text.includes('practiced') && !text.includes('learned');
            }
            
            cleanSongTitle(title) {
                // Remove common prefixes that aren't part of the title
                title = title.replace(/^(the|a|an)\s+/i, '');
                
                // Proper capitalization
                return title.split(' ')
                    .map(word => {
                        // Keep small words lowercase unless first word
                        if (['of', 'the', 'in', 'on', 'at', 'to', 'a', 'an'].includes(word.toLowerCase())) {
                            return word.toLowerCase();
                        }
                        return word.charAt(0).toUpperCase() + word.slice(1);
                    })
                    .join(' ')
                    .replace(/^./, char => char.toUpperCase()); // Ensure first letter is capital
            }
            
            cleanArtistName(artist) {
                // Handle special cases
                if (/^the\s+/i.test(artist)) {
                    return 'The ' + artist.slice(4).split(' ')
                        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
                        .join(' ');
                }
                
                // Standard capitalization
                return artist.split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
            }
            
            deduplicateSongs(songs) {
                const seen = new Map();
                songs.forEach(song => {
                    const key = song.title.toLowerCase();
                    if (!seen.has(key) || (song.artist && !seen.get(key).artist)) {
                        seen.set(key, song);
                    }
                });
                return Array.from(seen.values());
            }
            
            groupTechniques(techniques) {
                const groups = [];
                
                // Group timing-related
                const timing = techniques.filter(t => 
                    t.includes('bpm') || t.includes('BPM') || 
                    t.includes('metronome') || t.includes('tempo') || 
                    t.includes('timing')
                );
                if (timing.length > 0) {
                    groups.push(`Focused on timing and tempo control â€” ${timing.join(', ')}`);
                }
                
                // Group rhythm patterns
                const patterns = techniques.filter(t => 
                    t.includes('notes') || t.includes('triplets') || 
                    t.includes('sextuplets') || t.includes('groove') || 
                    t.includes('pattern') || t.includes('fills')
                );
                if (patterns.length > 0) {
                    groups.push(`Practiced rhythm patterns â€” ${patterns.join(', ')}`);
                }
                
                // Group technique work
                const technical = techniques.filter(t => 
                    t.includes('technique') || t.includes('independence') || 
                    t.includes('coordination') || t.includes('control') || 
                    t.includes('foot') || t.includes('hi-hat') || 
                    t.includes('kick') || t.includes('cross-stick')
                );
                if (technical.length > 0) {
                    groups.push(`Developed technique â€” ${technical.join(', ')}`);
                }
                
                // Anything else
                const other = techniques.filter(t => 
                    !timing.includes(t) && !patterns.includes(t) && !technical.includes(t)
                );
                if (other.length > 0) {
                    groups.push(`Additional focus areas â€” ${other.join(', ')}`);
                }
                
                return groups;
            }
            
            formatHomeworkItem(instruction) {
                // Clean up the instruction and make it actionable
                instruction = instruction.trim();
                
                // Ensure it starts with a capital
                instruction = instruction.charAt(0).toUpperCase() + instruction.slice(1);
                
                // Remove trailing punctuation
                instruction = instruction.replace(/[.,!?]+$/, '');
                
                // Make it imperative if it isn't already
                if (!instruction.match(/^(Practice|Work|Focus|Keep|Continue|Play|Review|Record)/i)) {
                    instruction = 'Practice ' + instruction.toLowerCase();
                }
                
                return instruction;
            }
        }
        
        // Examples
        const examples = {
            1: "Conan - Worked through bossa nova, playing to couple different songs keeping it consistent. broke into master of puppets by metallica and worked out some of timing. sounding really good its come a long way. lastly went through foot techniques",
            2: "Morgan - Worked through The Cure - Friday I'm In Love most of episode. played through first at 90% speed then cranked it at full. great job, spoke about technique with hh and keeping it light so we can play through whole song. keep kick nice and steady",
            3: "Luca - Went through triplets from 60-70bpm. doing great, try for 80 next week. played seven nation army, just chorus to work on. played radioactive which sounds very good! lastly started to learn i will survive",
            4: "Jazz session with Maya - worked on take five by dave brubeck, focusing on the 5/4 time signature. Also started autumn leaves, working on brush technique. Keep practicing the jazz swing feel with metronome at 120bpm",
            5: "Alex worked on Blitzkrieg Bop by the ramones at full speed! Also started learning basket case by green day. Try to keep the punk energy but stay in control. Work on down strokes for that authentic punk sound",
            6: "Emma - played Levitating by Dua Lipa, nailed the disco groove. Also worked on Good 4 U by Olivia Rodrigo - the dynamics between verse and chorus are getting better. Keep practicing those ghost notes on the snare"
        };
        
        // Initialize formatter
        const formatter = new SmartLessonFormatter();
        
        // Functions
        function formatLesson() {
            const input = document.getElementById('input').value;
            const output = formatter.format(input);
            document.getElementById('output').innerText = output;
        }
        
        function clearInput() {
            document.getElementById('input').value = '';
            document.getElementById('output').innerText = 'Your formatted lesson recap will appear here...';
        }
        
        function loadExample(num) {
            document.getElementById('input').value = examples[num] || '';
            formatLesson();
        }
        
        function copyToClipboard() {
            const text = document.getElementById('output').innerText;
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ… Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }
        
        function downloadText() {
            const text = document.getElementById('output').innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lesson-recap-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
        }
        
        // Auto-format on Enter with Ctrl/Cmd
        document.getElementById('input').addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                formatLesson();
            }
        });
    </script>
</body>
</html>
